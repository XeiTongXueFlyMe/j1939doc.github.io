<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>J1939Socket: J1939Socket API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">J1939Socket
   &#160;<span id="projectnumber">Version 2.0.0</span>
   </div>
   <div id="projectbrief">基于SAE J1939协议，开源可移植的J1939驱动，本说明书看齐最新源代码，如遇接口描述不同请更新源代码。</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('labelid1.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">J1939Socket API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md0"></a>
API 函数概要表</h1>
<table class="doxtable">
<tr>
<th align="center">函数名</th><th align="center">函数描述  </th></tr>
<tr>
<td align="center"><a class="el" href="_j1939_8h_a1634bbde52e0474441f60598fa194e7d.html#a1634bbde52e0474441f60598fa194e7d">J1939_Initialization()</a></td><td align="center">初始化J1939协议栈，并向总线声明地址 </td></tr>
<tr>
<td align="center"><a class="el" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll()</a></td><td align="center">系统心跳函数，完成J1939协议栈的所有运行逻辑 </td></tr>
<tr>
<td align="center"><a class="el" href="_j1939_8h_a2bb9111daa06c5f3975b2f5a3b586527.html#a2bb9111daa06c5f3975b2f5a3b586527">J1939_DequeueMessage()</a></td><td align="center">读取单帧消息，有消息，返回 RC_SUCCESS （非阻塞I/0接口） </td></tr>
<tr>
<td align="center"><a class="el" href="_j1939_8h_ac593e3a3951a73cc41fc5a8391a0e061.html#ac593e3a3951a73cc41fc5a8391a0e061">J1939_EnqueueMessage()</a></td><td align="center">发送单帧消息，发送成功，返回 RC_SUCCESS（非阻塞I/0接口） </td></tr>
<tr>
<td align="center"><a class="el" href="_j1939_8h_a485a992689e86ad9b86c49378c12c673.html#a485a992689e86ad9b86c49378c12c673" title="这是一个非阻塞io接口 ">J1939_TP_TX_Message()</a></td><td align="center">发送字节数大于8字节的数据，又称（多组，多帧，长帧）的TP发送，发送成功，返回 RC_SUCCESS（非阻塞I/0接口） </td></tr>
<tr>
<td align="center"><a class="el" href="_j1939_8h_ad861ff483284f4047185d6c6b6db871c.html#ad861ff483284f4047185d6c6b6db871c">J1939_TP_RX_Message()</a></td><td align="center">读取 （多组，多帧，长帧）的数据，有消息，返回 RC_SUCCESS （非阻塞I/0接口） </td></tr>
<tr>
<td align="center">J1939_Request_PGN()</td><td align="center">向总线请求获取一个PGN，如果PGN被其他ECU支持，将有相应的响应和PGN消息被发到总线上 </td></tr>
<tr>
<td align="center">J1939_Create_Response()</td><td align="center">创建一个PGN响应，如果收到一个PGN请求，则发送相应的响应和PGN。在总线上 </td></tr>
</table>
<hr/>
<h1><a class="anchor" id="autotoc_md2"></a>
J1939_Initialization()</h1>
<blockquote class="doxtable">
<ol type="1">
<li>调用此函数前，需要先初始化相关的CAN硬件</li>
<li>此函数全局只能被调用一次</li>
<li>此函数默认初始化4路CAN硬件，如果你的芯片只支持2路或更少，只需移植一路或多路，本函数初始化4路的全局变量不会影响协议栈的正确使用。</li>
<li>如果总线存在我们要声明的地址，并且我们竞争不过，会产生等待地址超时，J1939_Flags.CannotClaimAddress将会被置1.协议栈将会不启动，就算我们调用API函数协议栈不会做出响应。 </li>
</ol>
</blockquote>
<blockquote class="doxtable">
<ul>
<li>最佳使用 demo </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    <span class="comment">//初始化can驱动</span></div><div class="line">    init_can();</div><div class="line">    <span class="comment">//初始化J1939协议栈</span></div><div class="line">    <a class="code" href="_j1939_8h_a1634bbde52e0474441f60598fa194e7d.html#a1634bbde52e0474441f60598fa194e7d">J1939_Initialization</a>( TRUE );</div><div class="line">    <span class="comment">//等待地址超时</span></div><div class="line">    <span class="keywordflow">while</span> (J1939_Flags.WaitingForAddressClaimContention)</div><div class="line">        <a class="code" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll</a>(5);</div><div class="line">    <span class="comment">//运行到这里，说明地址声明没有问题（设备已挂载到总线上）</span></div><div class="line">    <span class="keywordflow">while</span>(1)</div><div class="line">    {</div><div class="line">        ;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><hr/>
<h1><a class="anchor" id="autotoc_md4"></a>
J1939_Poll()</h1>
<blockquote class="doxtable">
<ol type="1">
<li>调用此函数前，需要先初始化J1939协议栈</li>
<li>此函数需要不断被调用，最好定时调用（J1939协议栈中断模式除外）</li>
<li>此函数全局只能被串行调用，不论是单片机前后设计模式，还是嵌入式操作系统设计模式。（串行调用是指，不能在J1939_Poll 代码段中产生本J1939_Poll代码段程序嵌套），建议全局设计一个j1939_poll()函数调用入口。</li>
<li>此函数默认处理4路CAN硬件，如果你的芯片只支持2路或更少，只需移植一路或多路。 </li>
</ol>
</blockquote>
<blockquote class="doxtable">
<ul>
<li>嵌入式操作系统中最佳使用 demo </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="comment">//这个demo中J1939_Initialization( TRUE )，和J1939_Poll(10)。</span></div><div class="line"><span class="comment">//在全局中，只有这里被调用。CAN硬件初始化在嵌入式操作系统初始化之前</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> thread_j1939 (<span class="keywordtype">void</span> <span class="keyword">const</span> *argument)</div><div class="line">{</div><div class="line"></div><div class="line">    <a class="code" href="_j1939_8h_a1634bbde52e0474441f60598fa194e7d.html#a1634bbde52e0474441f60598fa194e7d">J1939_Initialization</a>( TRUE );</div><div class="line">    <span class="comment">// 等待地址声明超时</span></div><div class="line">    <span class="keywordflow">while</span> (J1939_Flags.WaitingForAddressClaimContention)</div><div class="line">        <a class="code" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll</a>(5);</div><div class="line">    <span class="comment">//地址已经声明好（设备已挂载到总线上）</span></div><div class="line">    <span class="keywordflow">while</span>(1)</div><div class="line">    {</div><div class="line">        <span class="comment">//系统等待10MS的信号量0x01,换句话说，如果CAN硬件没有接收到消息，J1939_Poll(10)，10ms被调用一次，如果CAN硬件收到消息，将立即被调用</span></div><div class="line">        osSignalWait(0x01,10);</div><div class="line">        <a class="code" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll</a>(10);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//CAN硬件的接受中断</span></div><div class="line"><span class="comment">//这里我启用4路CAN硬件，我将4路CAN硬件的接受中断都指向了ISR_CAN_NODE（）函数。</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ISR_CAN_NODE( )</div><div class="line">{</div><div class="line">    osSignalSet(thread_j1939_ID,0x01);</div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<ul>
<li>前后台系统中最佳使用 demo （单板设计模式，没有操作系统，只有main（）和 中断函数） </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="comment">//这个demo中J1939_Initialization( TRUE )，</span></div><div class="line"><span class="comment">//在全局中，只有这里被调用。</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    <span class="comment">//初始化can驱动，定时器初始化</span></div><div class="line">    init_can();</div><div class="line">    timerInit(1);</div><div class="line">    <span class="comment">//初始化J1939协议栈</span></div><div class="line">    <a class="code" href="_j1939_8h_a1634bbde52e0474441f60598fa194e7d.html#a1634bbde52e0474441f60598fa194e7d">J1939_Initialization</a>( TRUE );</div><div class="line">    <span class="comment">//等待地址超时</span></div><div class="line">    <span class="keywordflow">while</span> (J1939_Flags.WaitingForAddressClaimContention)</div><div class="line">        <a class="code" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll</a>(5);</div><div class="line"></div><div class="line">    <span class="comment">//在这里启动定时器</span></div><div class="line">    timerStart();</div><div class="line">    <span class="keywordflow">while</span>(1)</div><div class="line">    {</div><div class="line">     ;<span class="comment">//你的代码,这里可以调用API。</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//开启一个定时器 1MS （也可以是10MS，注意J1939_Poll的带入参数）</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> timer_j1939()</div><div class="line">{</div><div class="line">      <a class="code" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll</a>(1);</div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<ul>
<li>裸板使用 demo （最简单的模式） </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="comment">//这个demo中J1939_Initialization( TRUE )，</span></div><div class="line"><span class="comment">//在全局中，只有这里被调用。</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    <span class="comment">//初始化can驱动，定时器初始化</span></div><div class="line">    init_can();</div><div class="line">    <span class="comment">//初始化J1939协议栈</span></div><div class="line">    <a class="code" href="_j1939_8h_a1634bbde52e0474441f60598fa194e7d.html#a1634bbde52e0474441f60598fa194e7d">J1939_Initialization</a>( TRUE );</div><div class="line">    <span class="comment">//等待地址超时</span></div><div class="line">    <span class="keywordflow">while</span> (J1939_Flags.WaitingForAddressClaimContention)</div><div class="line">        <a class="code" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll</a>(5);</div><div class="line">    <span class="keywordflow">while</span>(1)</div><div class="line">    {</div><div class="line">        <a class="code" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll</a>(1);</div><div class="line">         delay1ms();</div><div class="line">         ;<span class="comment">//你的代码，可以调用J1939其他的API</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> delay1ms(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i,j,k;</div><div class="line">    <span class="keywordflow">for</span>(i=5;i&gt;0;i--)</div><div class="line">        <span class="keywordflow">for</span>(j=4;j&gt;0;j--)</div><div class="line">            <span class="keywordflow">for</span>(k=248;k&gt;0;k--);</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><hr/>
<h1><a class="anchor" id="autotoc_md6"></a>
J1939_EnqueueMessage()</h1>
<blockquote class="doxtable">
<ol type="1">
<li>调用此函数前，需要先初始化J1939协议栈，J1939_Initialization()和 <a class="el" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll()</a>正确的被调用</li>
<li>需要了解 J1939的ID组成结构，和 J1939_MESSAGE 结构体 </li>
</ol>
</blockquote>
<blockquote class="doxtable">
<ul>
<li>最佳推荐调用方式 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sendMsg( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html">J1939_MESSAGE</a> _msg;</div><div class="line">    <span class="comment">/*****发送数据(参考J1939的ID组成填充下面)***/</span></div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a6b25f85b55c0d06ad98b8d472ba85937">DataPage</a> = 0;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#aed045d88b5b0a4a8dc72486d612a772c">Priority</a> = J1939_CONTROL_PRIORITY;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.DestinationAddress = 0x0f;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a311918f94c3980a2f7d011b93cc3c223">DataLength</a> = 8;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#aa880f27ed7c7789066020f8fab6f94cd">PDUFormat</a> = 0xfe;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[0] = 1;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[1] = 2;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[2] = 3;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[3] = 4;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[4] = 5;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[5] = 6;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[6] = 7;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[7] = 8;</div><div class="line">    <span class="keywordflow">while</span> (<a class="code" href="_j1939_8h_ac593e3a3951a73cc41fc5a8391a0e061.html#ac593e3a3951a73cc41fc5a8391a0e061">J1939_EnqueueMessage</a>( &amp;_msg, <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baa7dea1c850a0e3f15d01b1209805b79a">Select_CAN_NODE_1</a>) != RC_SUCCESS);</div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<ul>
<li>一次性调用几路CAN硬件发送数据 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sendMsg( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html">J1939_MESSAGE</a> _msg;</div><div class="line">    <span class="comment">/*****发送数据(参考J1939的ID组成填充下面)***/</span></div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a6b25f85b55c0d06ad98b8d472ba85937">DataPage</a> = 0;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#aed045d88b5b0a4a8dc72486d612a772c">Priority</a> = J1939_CONTROL_PRIORITY;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.DestinationAddress = 0x0f;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a311918f94c3980a2f7d011b93cc3c223">DataLength</a> = 8;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#aa880f27ed7c7789066020f8fab6f94cd">PDUFormat</a> = 0xfe;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[0] = 1;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[1] = 2;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[2] = 3;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[3] = 4;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[4] = 5;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[5] = 6;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[6] = 7;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[7] = 8;</div><div class="line">    <span class="keywordflow">while</span> (<a class="code" href="_j1939_8h_ac593e3a3951a73cc41fc5a8391a0e061.html#ac593e3a3951a73cc41fc5a8391a0e061">J1939_EnqueueMessage</a>( &amp;_msg, <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baa7dea1c850a0e3f15d01b1209805b79a">Select_CAN_NODE_1</a>) != RC_SUCCESS);</div><div class="line">    <span class="keywordflow">while</span> (<a class="code" href="_j1939_8h_ac593e3a3951a73cc41fc5a8391a0e061.html#ac593e3a3951a73cc41fc5a8391a0e061">J1939_EnqueueMessage</a>( &amp;_msg, <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>) != RC_SUCCESS);</div><div class="line">    <span class="keywordflow">while</span> (<a class="code" href="_j1939_8h_ac593e3a3951a73cc41fc5a8391a0e061.html#ac593e3a3951a73cc41fc5a8391a0e061">J1939_EnqueueMessage</a>( &amp;_msg, <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67bae729ea20e94e2498de857037f6aadbf9">Select_CAN_NODE_3</a>) != RC_SUCCESS);</div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<ul>
<li>调用方式1 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sendMsg( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html">J1939_MESSAGE</a> _msg;</div><div class="line">    <span class="comment">/*****发送数据(参考J1939的ID组成填充下面)***/</span></div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a6b25f85b55c0d06ad98b8d472ba85937">DataPage</a> = 0;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#aed045d88b5b0a4a8dc72486d612a772c">Priority</a> = J1939_CONTROL_PRIORITY;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.DestinationAddress = 0x0f;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a311918f94c3980a2f7d011b93cc3c223">DataLength</a> = 8;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#aa880f27ed7c7789066020f8fab6f94cd">PDUFormat</a> = 0xfe;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[0] = 1;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[1] = 2;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[2] = 3;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[3] = 4;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[4] = 5;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[5] = 6;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[6] = 7;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[7] = 8;</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="_j1939_8h_ac593e3a3951a73cc41fc5a8391a0e061.html#ac593e3a3951a73cc41fc5a8391a0e061">J1939_EnqueueMessage</a>( &amp;_msg, <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baa7dea1c850a0e3f15d01b1209805b79a">Select_CAN_NODE_1</a>) == RC_CANNOTTRANSMIT)</div><div class="line">    {</div><div class="line">        ;<span class="comment">//系统目前不能发送消息可能是 J1939_Initialization（）地址竞争不成功</span></div><div class="line">         <span class="comment">//做出相应的处理，一般J1939_EnqueueMessage不会返回RC_CANNOTTRANSMIT </span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<ul>
<li>调用方式2 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sendMsg( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html">J1939_MESSAGE</a> _msg;</div><div class="line">    <span class="comment">/*****发送数据(参考J1939的ID组成填充下面)***/</span></div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a6b25f85b55c0d06ad98b8d472ba85937">DataPage</a> = 0;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#aed045d88b5b0a4a8dc72486d612a772c">Priority</a> = J1939_CONTROL_PRIORITY;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.DestinationAddress = 0x0f;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a311918f94c3980a2f7d011b93cc3c223">DataLength</a> = 8;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#aa880f27ed7c7789066020f8fab6f94cd">PDUFormat</a> = 0xfe;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[0] = 1;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[1] = 2;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[2] = 3;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[3] = 4;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[4] = 5;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[5] = 6;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[6] = 7;</div><div class="line">    _msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.<a class="code" href="struct_j1939___m_e_s_s_a_g_e___u_n_i_o_n_1_1j1939___p_i_d.html#a1da55828924eebb623e9f8eefb0715f7">Data</a>[7] = 8;</div><div class="line">    <a class="code" href="_j1939_8h_ac593e3a3951a73cc41fc5a8391a0e061.html#ac593e3a3951a73cc41fc5a8391a0e061">J1939_EnqueueMessage</a>( &amp;_msg, <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baa7dea1c850a0e3f15d01b1209805b79a">Select_CAN_NODE_1</a>);</div><div class="line">}</div></div><!-- fragment --><hr/>
<h1><a class="anchor" id="autotoc_md8"></a>
J1939_DequeueMessage()</h1>
<blockquote class="doxtable">
<ol type="1">
<li>调用此函数前，需要先初始化J1939协议栈，J1939_Initialization()和 <a class="el" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll()</a>正确的被调用</li>
<li>需要了解 J1939的ID组成结构，和 J1939_MESSAGE 结构体 </li>
</ol>
</blockquote>
<blockquote class="doxtable">
<ul>
<li>最佳推荐调用方式 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> readMsg( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html">J1939_MESSAGE</a> _msg;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="_j1939_8h_a2bb9111daa06c5f3975b2f5a3b586527.html#a2bb9111daa06c5f3975b2f5a3b586527">J1939_DequeueMessage</a>( &amp;_msg, <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baa7dea1c850a0e3f15d01b1209805b79a">Select_CAN_NODE_1</a>) == RC_SUCCESS) </div><div class="line">    {</div><div class="line">        <span class="comment">/***********处理接受数据*************/</span></div><div class="line">        ;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<ul>
<li>一次性处理几路CAN硬件 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> readMsg( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html">J1939_MESSAGE</a> _msg[2];</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="_j1939_8h_a2bb9111daa06c5f3975b2f5a3b586527.html#a2bb9111daa06c5f3975b2f5a3b586527">J1939_DequeueMessage</a>( _msg, <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baa7dea1c850a0e3f15d01b1209805b79a">Select_CAN_NODE_1</a>) == RC_SUCCESS) </div><div class="line">    {</div><div class="line">        <span class="comment">/***********处理接受PUD1格式数据*************/</span></div><div class="line">        <span class="keywordflow">if</span>(_msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.PGN == 0x000100)</div><div class="line">        {</div><div class="line">            ;<span class="comment">//你的代码</span></div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="_j1939_8h_a2bb9111daa06c5f3975b2f5a3b586527.html#a2bb9111daa06c5f3975b2f5a3b586527">J1939_DequeueMessage</a>( (_msg+1), <a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>) == RC_SUCCESS) </div><div class="line">    {</div><div class="line">        <span class="comment">/***********处理接受PDU2格式数据*************/</span></div><div class="line">        <span class="keywordflow">if</span>(_msg.<a class="code" href="union_j1939___m_e_s_s_a_g_e___u_n_i_o_n.html#a19ca4a91edcc8b6fa4a8fac99a4a3399">Mxe</a>.PGN == 0x00F101)</div><div class="line">        {</div><div class="line">            ;<span class="comment">//你的代码</span></div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> <hr/>
<h1><a class="anchor" id="autotoc_md10"></a>
J1939_TP_TX_Message()</h1>
<blockquote class="doxtable">
<ol type="1">
<li>调用此函数前，需要先初始化J1939协议栈，J1939_Initialization()和 <a class="el" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll()</a>正确的被调用</li>
<li>需要了解 <a class="el" href="_j1939_8h_a485a992689e86ad9b86c49378c12c673.html#a485a992689e86ad9b86c49378c12c673" title="这是一个非阻塞io接口 ">J1939_TP_TX_Message()</a>函数具体的代入参数 </li>
</ol>
</blockquote>
<blockquote class="doxtable">
<ul>
<li>最佳推荐调用方式 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> TP_TX_Msg( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <a class="code" href="_j1939_8h.html#a9e9f4a9bd6c4a189e06fa67d441d65f7">j1939_int8_t</a> _data[100] = {1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7};</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(RC_SUCCESS != <a class="code" href="_j1939_8h_a485a992689e86ad9b86c49378c12c673.html#a485a992689e86ad9b86c49378c12c673">J1939_TP_TX_Message</a>(65259,0XF1,(<a class="code" href="_j1939_8h.html#a9e9f4a9bd6c4a189e06fa67d441d65f7">j1939_int8_t</a>*)_data,<span class="keyword">sizeof</span>(_data),<a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>));</div><div class="line">}</div></div><!-- fragment --><hr/>
<h1><a class="anchor" id="autotoc_md12"></a>
J1939_TP_RX_Message()</h1>
<blockquote class="doxtable">
<ol type="1">
<li>调用此函数前，需要先初始化J1939协议栈，J1939_Initialization()和 <a class="el" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll()</a>正确的被调用</li>
<li>需要了解 <a class="el" href="_j1939_8h_a485a992689e86ad9b86c49378c12c673.html#a485a992689e86ad9b86c49378c12c673" title="这是一个非阻塞io接口 ">J1939_TP_TX_Message()</a>函数具体的代入参数 </li>
</ol>
</blockquote>
<blockquote class="doxtable">
<ul>
<li>最佳推荐调用方式 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> TP_RX_Msg( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <a class="code" href="_j1939_8h.html#a9e9f4a9bd6c4a189e06fa67d441d65f7">j1939_int8_t</a> _data[100] = {1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7};</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>(RC_SUCCESS != <a class="code" href="_j1939_8h_ad861ff483284f4047185d6c6b6db871c.html#ad861ff483284f4047185d6c6b6db871c">J1939_TP_RX_Message</a>((<a class="code" href="_j1939_8h.html#a9e9f4a9bd6c4a189e06fa67d441d65f7">j1939_int8_t</a>*)_data,<span class="keyword">sizeof</span>(_data),<a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>));</div><div class="line">}</div></div><!-- fragment --><hr/>
 <h1><a class="anchor" id="autotoc_md14"></a>
J1939_Request_PGN()</h1>
<blockquote class="doxtable">
<ol type="1">
<li>调用此函数前，需要先初始化J1939协议栈，J1939_Initialization()和 <a class="el" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll()</a>正确的被调用</li>
<li>需要了解J1939-21,16~18页的请求与响应</li>
<li>向总线请求获去一个PGN，PGN可以是单帧的，也可以是多帧的。 本函数只发送PGN请求，不处理ACK和NACK等响应消息，和被请求的PGN消息，可以调用J1939_DequeueMessage() 和 <a class="el" href="_j1939_8h_ad861ff483284f4047185d6c6b6db871c.html#ad861ff483284f4047185d6c6b6db871c">J1939_TP_RX_Message()</a>读取数据后，自行处理或不处理。 4.每调用J1939_Request_PGN()一次，可能会收到ACK和NACK等消息，和被请求的PGN消息。情况相当复杂，设计多帧与单帧，PDU1与PDU2等的关系。具体情况1939-21,17页，表4有描述。 </li>
</ol>
</blockquote>
<blockquote class="doxtable">
<ul>
<li>最佳推荐调用方式 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="comment">/*向特定地址请求PGN，PGN可以是多帧和单帧的*/</span></div><div class="line"><span class="comment">/*点对点请求*/</span></div><div class="line"><span class="keywordtype">void</span> my_Request_PGN( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <span class="comment">/*请求一个PDU1格式的PGN*/</span></div><div class="line">    J1939_Request_PGN(0x000100,56,<a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>);</div><div class="line">    <span class="comment">/*请求一个PDU2格式的PGN*/</span></div><div class="line">    J1939_Request_PGN(0x00F101,56,<a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>);</div><div class="line">}</div><div class="line"><span class="comment">/*广播请求PGN，PGN可以是多帧和单帧的*/</span></div><div class="line"><span class="comment">/*点对多请求，可能收到来自不同ECU数据，如果多个ECU对同一个PGN支持*/</span></div><div class="line"><span class="keywordtype">void</span> my_Request_PGN( <span class="keywordtype">void</span> )</div><div class="line">{</div><div class="line">    <span class="comment">/*请求一个PDU1格式的PGN*/</span></div><div class="line">    J1939_Request_PGN(0x000100,J1939_GLOBAL_ADDRESS,<a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>);</div><div class="line">    <span class="comment">/*请求一个PDU2格式的PGN*/</span></div><div class="line">    J1939_Request_PGN(0x00F101,J1939_GLOBAL_ADDRESS,<a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>);</div><div class="line">}</div></div><!-- fragment --><hr/>
<h1><a class="anchor" id="autotoc_md16"></a>
J1939_Create_Response()</h1>
<blockquote class="doxtable">
<ol type="1">
<li>调用此函数前，需要先初始化J1939协议栈，J1939_Initialization()和 <a class="el" href="_j1939_8h_ac4849b368e4286a1154f4eaadef215b2.html#ac4849b368e4286a1154f4eaadef215b2">J1939_Poll()</a>正确的被调用</li>
<li>需要了解J1939-21,16~18页的请求与响应</li>
<li>同一个PGN响应，只需要创建一次，多次被创建，协议栈会以第一次为主。</li>
<li>注意：J1939_Create_Response（）需要传入一个数据指针，和相应的数据更新函数，</li>
<li>如果你不需要数据更新函数，你可以带入参数 J1939_NULL </li>
</ol>
</blockquote>
<blockquote class="doxtable">
<ul>
<li>最佳推荐调用方式 </li>
</ul>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ResponseTestData[8];</div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ResponseTestTPData[17];</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*用来更新数据的函数， PGN响应功能被请求消息触发时，都会提前调用本函数，然后发送 ACK和NACK等消息，和被请求的PGN消息。*/</span></div><div class="line"><span class="comment">/*此函数不宜写的太复杂，浪费CPU资源*/</span></div><div class="line"><span class="keywordtype">void</span> ResponseTestUpdata()</div><div class="line">{</div><div class="line">    ResponseTestData[0] = (BatInfo.Voltage &amp; 0x00FF);<span class="comment">//BatInfo.Voltage是一个全局变量，用作记录采集的电压</span></div><div class="line">    ResponseTestData[0] = (BatInfo.Voltage &gt;&gt; 8) &amp; 0x00FF;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ResponseTest()</div><div class="line">{</div><div class="line">    <span class="comment">/*响应是单帧还是多帧，接口通过代入的数据长度识别，PDU1还是PDU2,通过PGN识别*/</span></div><div class="line">    <span class="comment">/*创建一个单帧PGN的响应*/</span></div><div class="line">    J1939_Create_Response(ResponseTestData,8,0x000200,ResponseTestUpdata,<a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>);</div><div class="line">    <span class="comment">/*创建一个多帧PGN的响应*/</span></div><div class="line">    J1939_Create_Response(ResponseTestTPData,17,0x00FE33,J1939_NULL,<a class="code" href="_j1939_8h_afa47c62b47948afd20d3bf018a4fa67b.html#afa47c62b47948afd20d3bf018a4fa67baae1511c6e2916d45af460e1a43d18a80">Select_CAN_NODE_2</a>);</div><div class="line">}</div></div><!-- fragment --> <hr/>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">生成于 2017年 十二月 6日 星期三 08:58:08 , 为 J1939Socket使用 
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
